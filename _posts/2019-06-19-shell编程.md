---
layout:     post
title:      shell编程
subtitle:   shell脚本编写
date:       2019-06-19
author:     pengfeng
header-img: img/post-bg-hacker.jpg
catalog: true
tags:
    - java
    - shell
    - linux
---

此篇博客是我学习shell的产出.方便后期翻阅.


## 一、约定成俗与编写规范

### 1.脚本格式
脚本规定都是以 **#!/bin/bash**开头

### 2.脚本执行方式
```sql
./xx.sh 或者 sh xx.sh 执行
```
### 3.基本语法

`echo [选项] [输出内容]`  
-e：  支持反斜线控制的字符转换

|    控制字符 	|作用      |
| :-----------: |:------: |
| `\\`          |  输出\本身|
| `\a`          | 输出警告音 | 
| `\b`          | 退格键，也就是向左删除键|
| `\c`          | 取消输出行末的换行符。和“-n”选项一致|
| `\e`          | ESCAPE键|
| `\f`          | 换页符   |
| `\n`          | 换行符 |
| `\r`          | 回车键 |
| `\t`          | 制表符，也就是Tab键 |
| `\v`          | 垂直制表符 |
| `\0nnn`       | 按照八进制ASCII码表输出字符。其中0为数字零，nnn是三位八进制数 |
| `\xhh`        | 按照十六进制ASCII码表输出字符。其中hh是两位十六进制数 |


## 二、shell中的变量

linux中的环境变量分为系统变量和用户自定义变量.
常见的系统变量为`$HOME` `$PWD` 等等

![](/img/Setshell.jpg)

查看系统变量使用set命令即可查看

### 1.基本语法
    
>定义变量: 变量=值

>撤销变量: unset变量

>声明静态变量: readonly 变量  ,但是不能unset

### 2.变量定义规则

1.变量名称可以是字母,数字,下划线组成.但是不能以下划线开头,变量名称一般大写

2.等号两侧不能有空格

3.单引号和双引号的区别,单引号将所有的字符脱意,不转义,双引号只脱意空格,建议双引号.

### 3.Demo

![](/img/变量test.jpg)

### 4.将命令返回值赋给变量
```test
A=`ls -la`

echo $A 就相当于 ls -la命令

A=$(ls -la) 相当于反``

（1）export 变量名=变量值	（功能描述：设置环境变量的值）
（2）source 配置文件		（功能描述：让修改后的配置信息立即生效）
（3）echo $变量名			（功能描述：查询环境变量的值）
```


|    命令 	    |  作用  |
| :-----------: | :-------------------------------------------------------------------:                   |
| `$n`          | n为数字，$0代表命令本身，$1-$9代表第一到第九个参数，十以上的参数，十以上的参数需要用大括号包含，如${10}|
| `$*`          | 这个变量代表命令行中所有的参数，$*把所有的参数看成一个整体                                        | 
| `$@`          | 这个变量也代表命令行中所有的参数，不过$@把每个参数区分对待                                        |
| `$#`          | 这个变量代表命令行中所有参数的个数                                                            |
| `$?`          | 上个命令的退出状态，或函数的返回值。                                                          |
| `$$`          | 当前Shell进程ID。对于 Shell 脚本，就是这些脚本所在的进程ID。                                    |
| `$!`          | 后台运行的最后一个进程的进程号（PID）                                                         |


## 三、运算符

（1）“$((运算式))”或“$[运算式]”
（2）expr m + n 注意expr运算符间要有空格
（3）expr m - n \自由主题 注意expr运算符间要有空格
（4）/*, /, % 乘，除，取余

例:
```jshelllanguage
S=$[(2+3)*4]
echo $S

S=`expr 2 + 3`
expr $S \* 4

expr `expr 2 + 3` \* 4
```

## 四、条件判断

[condition] 类似这样的语法

|    命令 	    | 作用     |
| :-----------: |:------: |
| `=`           | 等于   |
| `-lt`         | 小于   | 
| `-le`         | 小于等于|
| `-eq`         | 等于   |
| `-gt`         | 大于   |
| `-ge`         | 大于等于|
| `-nt`         | 不等于  |
| `-r`          | 有读权限|
| `-w`          | 有写权限   |
| `-x`          | 有执行权限|
| `-f`          | 文件存在并且是一个常规的文件 |
| `-e`          | 文件存在 |
| `-d`          | 文件存在并是一个目录 |


## 五、流程控制

### 1.语法

#### 1.1 if语句


```text
if [ 条件判断式 ];then 
  程序 
fi 
或者
if [ 条件判断式 ] 
  then 
    程序 
fi

```

#### 1.2 case语句

```text
case $变量名 in 
  "值1"） 
    如果变量的值等于值1，则执行程序1 
    ;; 
  "值2"） 
    如果变量的值等于值2，则执行程序2 
    ;; 
  …省略其他分支… 
  *） 
    如果变量的值都不是以上的值，则执行此程序 
    ;; 
esac
```

#### 1.3 for循环

>语法一:
```text
for 变量 in 值1 值2 值3… 
  do 
    程序 
  done
```
demo:

```text
#!/bin/bash

#打印数字

for i in "$*"

    do
      echo "The num is $i "
    done


for j in "$@"

        do
        echo "The num is $j"
        done
```

>语法二:

```text
for (( 初始值;循环控制条件;变量变化 )) 
  do 
    程序 
  done
```
demo:

```text
#!/bin/bash

s=0

for((i=0;i<=100;i++))

do
        s=$[$s+$i]
done

echo "$s"
```

#### 1.4 while语法

```text
while [ 条件判断式 ] 
  do 
    程序 
  done
```
demo

```text
#!/bin/bash

s=0

i=1

while [ $i -le 100 ]
do
        s=$[$s+$i]
        i=$[$i+1]
done

echo $s
```

## 六、读取控制台输入

read读取控制台输入

>语法:
read(选项)(参数)

*选项* -p：指定读取值时的提示符；-t：指定读取值时等待的时间（秒）

*参数* 变量：指定读取值的变量名

```text
#!/bin/bash

read -t 7 -p "please 7 miao input your name " NAME

echo $NAME
```


## 七、函数

>basename基本语法

basename [pathname] [suffix]

功能描述：basename命令会删掉所有的前缀包括最后一个（‘/’）字符，然后将字符串显示出来。

![](/img/shell后缀.jpg)

>dirname基本语法

![](/img/截取文件夹.jpg)

>自定义函数

（1）必须在调用函数地方之前，先声明函数，shell脚本是逐行运行。不会像其它语言一样先编译。
（2）函数返回值，只能通过$?系统变量获得，可以显示加：return返回，如果不加，将以最后一条命令运行结果，作为返回值。return后跟数值n(0-255)
 
 ```text
#!/bin/bash

function sum()

{

    s=0

    s=$[ $1 + $2 ]

    echo "$s"

}

read -p "Please input the number1: " n1;

read -p "Please input the number: " n2;

sum $n1 $n2;


```